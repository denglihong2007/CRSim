<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="CRSim.Views.ScreenSimulatorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CRSim.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:CRSim.Converters"     
    xmlns:converters1="using:CommunityToolkit.WinUI.Converters"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"   
    xmlns:winui="using:CommunityToolkit.WinUI"   
    xmlns:viewmodels="using:CRSim.ViewModels"   
    xmlns:models="using:CRSim.Models"     
    xmlns:coremodels="using:CRSim.Core.Models"     
    xmlns:pluginmodels="using:CRSim.Core.Models.Plugin"     
    Loaded="Page_Loaded"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance Type=viewmodels:ScreenSimulatorPageViewModel}">
    <Page.Resources>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter" />
        <converters1:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Page.Resources>
    <Grid x:Name="ContentPagePane" Margin="36,40,0,36">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <TextBlock Grid.Row="0" Text="{x:Bind ViewModel.PageTitle}" Margin="0,0,0,36"
                   Style="{StaticResource TitleTextBlockStyle}"/>
        <ScrollViewer Grid.Row="1" Padding="0,0,36,0">
            <StackPanel>
                <Grid Margin="0,0,0,24" Visibility="{x:Bind ViewModel.SelectedStyle, Converter={StaticResource NullToVisibilityConverter},Mode=OneWay}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Border Grid.Column="0" CornerRadius="12" BorderThickness="8" BorderBrush="Black">
                        <Image Source="{x:Bind ViewModel.SelectedStyle.RealIconPath, Mode=OneWay}" Width="240" Height="180"/>
                    </Border>
                    <StackPanel Grid.Column="1" Orientation="Vertical" Margin="12,0,0,0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="{x:Bind ViewModel.SelectedStyle.Manifest.Name,Mode=OneWay}" />
                            <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="{x:Bind ViewModel.SelectedStyle.Manifest.Version, Mode=OneWay}" 
                                       Opacity="0.7" VerticalAlignment="Bottom" Margin="4,0,0,0"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="作者：" />
                            <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="{x:Bind ViewModel.SelectedStyle.Manifest.Author, Mode=OneWay}" />
                        </StackPanel>
                        <TextBlock Style="{StaticResource CaptionTextBlockStyle}" Text="{x:Bind ViewModel.SelectedStyle.Manifest.Description,Mode=OneWay}"/>
                    </StackPanel>
                </Grid>
                <TextBlock Text="主题列表" Style="{StaticResource BodyStrongTextBlockStyle}" Margin="0,0,0,12"/>
                <Border Background="{StaticResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" BorderBrush="{StaticResource CardStrokeColorDefaultBrush}" 
                        BorderThickness="1" Margin="0,0,0,24">
                    <ScrollViewer MaxHeight="400">
                        <StackPanel>
                            <GridView x:Name="StyleList" ItemsSource="{x:Bind ViewModel.StyleInfos}" SelectionMode="Single"
                                  Visibility="{x:Bind ViewModel.StyleInfos.Count,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=false}">
                                <interactivity:Interaction.Behaviors>
                                    <interactivity:EventTriggerBehavior EventName="SelectionChanged">
                                        <interactivity:InvokeCommandAction Command="{x:Bind ViewModel.StyleSelectedCommand}" CommandParameter="{x:Bind StyleList.SelectedItem,Mode=OneWay}" />
                                    </interactivity:EventTriggerBehavior>
                                </interactivity:Interaction.Behaviors>
                                <GridView.ItemTemplate>
                                    <DataTemplate x:DataType="pluginmodels:PluginInfo">
                                        <Grid Width="200" Height="150">
                                            <Image Source="{x:Bind RealIconPath}" Stretch="UniformToFill"/>
                                            <StackPanel Orientation="Vertical" Height="40" VerticalAlignment="Bottom" Padding="6,1">
                                                <StackPanel.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                        <GradientStop Color="#00000000" Offset="0"/>
                                                        <GradientStop Color="#CC000000" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </StackPanel.Background>
                                                <TextBlock Text="{x:Bind Manifest.Name}"/>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{x:Bind StyleInfo.Type}" Style="{ThemeResource CaptionTextBlockStyle}"
                                                               Foreground="{ThemeResource SystemControlPageTextBaseMediumBrush}"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </GridView.ItemTemplate>
                                <GridView.ItemContainerStyle>
                                    <Style TargetType="GridViewItem" BasedOn="{StaticResource DefaultGridViewItemStyle}">
                                        <Setter Property="Margin" Value="5"/>
                                    </Style>
                                </GridView.ItemContainerStyle>
                                <GridView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <ItemsWrapGrid x:Name="MaxItemsWrapGrid" Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </GridView.ItemsPanel>
                            </GridView>
                            <TextBlock Text="当前没有安装任何主题" Margin="0,50" TextAlignment="Center" Opacity="0.7"
                                       Visibility="{x:Bind ViewModel.StyleInfos.Count,Converter={StaticResource IntToVisibilityConverter},ConverterParameter=true}"/>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
                <TextBlock Text="参数配置" Style="{StaticResource BodyStrongTextBlockStyle}" Margin="0,0,0,12"/>
                <StackPanel Spacing="4" Orientation="Vertical" Margin="0,0,0,24">
                    <controls:SettingsCard Header="车站" Description="使用的车站数据库" HeaderIcon="{winui:FontIcon Glyph=&#xEC08;}"
                                       Visibility="{x:Bind ViewModel.StationNeeded,Converter={StaticResource BoolToVisibilityConverter},Mode=OneWay}">
                        <ComboBox ItemsSource="{x:Bind ViewModel.StationNames}" x:Name="StationNamesList">
                            <interactivity:Interaction.Behaviors>
                                <interactivity:EventTriggerBehavior EventName="SelectionChanged">
                                    <interactivity:InvokeCommandAction Command="{x:Bind ViewModel.StationSelectedCommand}" CommandParameter="{x:Bind StationNamesList.SelectedItem,Mode=OneWay}" />
                                </interactivity:EventTriggerBehavior>
                            </interactivity:Interaction.Behaviors>
                        </ComboBox>
                    </controls:SettingsCard>
                    <controls:SettingsCard Header="站台" Description="仅加载某个站台的数据" HeaderIcon="{winui:FontIcon Glyph=&#xE799;}"
                                       Visibility="{x:Bind ViewModel.PlatformNeeded,Converter={StaticResource BoolToVisibilityConverter},Mode=OneWay}">
                        <ComboBox ItemsSource="{x:Bind ViewModel.Platforms}" x:Name="PlatformsList">
                            <interactivity:Interaction.Behaviors>
                                <interactivity:EventTriggerBehavior EventName="SelectionChanged">
                                    <interactivity:InvokeCommandAction Command="{x:Bind ViewModel.SelectPlatformCommand}" CommandParameter="{x:Bind PlatformsList.SelectedItem,Mode=OneWay}" />
                                </interactivity:EventTriggerBehavior>
                            </interactivity:Interaction.Behaviors>
                        </ComboBox>
                    </controls:SettingsCard>
                    <controls:SettingsCard Header="检票口" Description="仅加载某个检票口的数据" HeaderIcon="{winui:FontIcon Glyph=&#xF161;}"
                                       Visibility="{x:Bind ViewModel.TicketCheckNeeded,Converter={StaticResource BoolToVisibilityConverter},Mode=OneWay}">
                        <ComboBox ItemsSource="{x:Bind ViewModel.TicketChecks}" x:Name="TicketChecksList">
                            <interactivity:Interaction.Behaviors>
                                <interactivity:EventTriggerBehavior EventName="SelectionChanged">
                                    <interactivity:InvokeCommandAction Command="{x:Bind ViewModel.SelectTicketCheckCommand}" CommandParameter="{x:Bind TicketChecksList.SelectedItem,Mode=OneWay}" />
                                </interactivity:EventTriggerBehavior>
                            </interactivity:Interaction.Behaviors>
                        </ComboBox>
                    </controls:SettingsCard>
                    <controls:SettingsCard Header="位置" Description="引导牌所处的车厢位置" HeaderIcon="{winui:FontIcon Glyph=&#xE707;}"
                                       Visibility="{x:Bind ViewModel.LocationNeeded,Converter={StaticResource BoolToVisibilityConverter},Mode=OneWay}">
                        <ComboBox ItemsSource="{x:Bind ViewModel.Locations}" x:Name="LocationsList">
                            <interactivity:Interaction.Behaviors>
                                <interactivity:EventTriggerBehavior EventName="SelectionChanged">
                                    <interactivity:InvokeCommandAction Command="{x:Bind ViewModel.SelectLocationCommand}" CommandParameter="{x:Bind LocationsList.SelectedItem,Mode=OneWay}" />
                                </interactivity:EventTriggerBehavior>
                            </interactivity:Interaction.Behaviors>
                        </ComboBox>
                    </controls:SettingsCard>
                    <controls:SettingsCard Header="视频资源路径" Description="视频广告资源（留空即为默认）" HeaderIcon="{winui:FontIcon Glyph=&#xE8B2;}"
                                       Visibility="{x:Bind ViewModel.VideoNeeded,Converter={StaticResource BoolToVisibilityConverter},Mode=OneWay}">
                        <TextBox Text="{x:Bind ViewModel.Video,Mode=TwoWay}" MaxWidth="120"/>
                    </controls:SettingsCard>
                    <controls:SettingsCard Header="文字提示" Description="附加的引导文字（留空即为默认）" HeaderIcon="{winui:FontIcon Glyph=&#xE8D2;}"
                                       Visibility="{x:Bind ViewModel.TextNeeded,Converter={StaticResource BoolToVisibilityConverter},Mode=OneWay}">
                        <TextBox Text="{x:Bind ViewModel.Text,Mode=TwoWay}" MaxWidth="120"/>
                    </controls:SettingsCard>
                </StackPanel>
                <TextBlock Text="参数配置" Style="{StaticResource BodyStrongTextBlockStyle}" Margin="0,0,0,12"/>
                <controls:SettingsCard Header="开始模拟" Description="启动一个新的模拟窗口" HeaderIcon="{winui:FontIcon Glyph=&#xE768;}"
                                       IsEnabled="{x:Bind ViewModel.IsStartSimulationAvailable,Mode=OneWay}">
                    <Button Content="开始模拟" Command="{x:Bind ViewModel.StartSimulationCommand}" Style="{StaticResource AccentButtonStyle}"/>
                </controls:SettingsCard>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
